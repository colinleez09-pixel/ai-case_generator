<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JavaScript执行测试</title>
</head>
<body>
    <h1>JavaScript执行测试</h1>
    <div id="test-results"></div>
    
    <script>
        console.log('开始测试JavaScript执行...');
        
        // 模拟页面加载完成事件
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded事件触发');
            
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>✓ JavaScript正常执行</p>';
            
            // 测试fetch请求
            fetch('http://127.0.0.1:5000')
                .then(response => response.text())
                .then(html => {
                    console.log('页面获取成功，长度:', html.length);
                    
                    // 检查关键修改
                    const checks = [
                        {
                            name: '遮罩层hidden类',
                            test: html.includes('chat-disabled-overlay hidden'),
                            expected: true
                        },
                        {
                            name: '静态初始消息移除',
                            test: !html.includes('你好！我是 AI 测试用例生成助手。请上传您的用例模板文件'),
                            expected: true
                        },
                        {
                            name: '动态消息注释',
                            test: html.includes('初始消息将通过JavaScript动态添加'),
                            expected: true
                        }
                    ];
                    
                    let allPassed = true;
                    checks.forEach(check => {
                        const passed = check.test === check.expected;
                        allPassed = allPassed && passed;
                        const status = passed ? '✓' : '✗';
                        results.innerHTML += `<p>${status} ${check.name}: ${passed ? '通过' : '失败'}</p>`;
                        console.log(`${status} ${check.name}: ${passed ? '通过' : '失败'}`);
                    });
                    
                    if (allPassed) {
                        results.innerHTML += '<p><strong>✓ 所有HTML修改都已正确应用！</strong></p>';
                        console.log('✓ 所有HTML修改都已正确应用！');
                    } else {
                        results.innerHTML += '<p><strong>✗ 部分修改未正确应用</strong></p>';
                        console.log('✗ 部分修改未正确应用');
                    }
                })
                .catch(error => {
                    console.error('获取页面失败:', error);
                    results.innerHTML += `<p>✗ 获取页面失败: ${error}</p>`;
                });
        });
    </script>
</body>
</html>