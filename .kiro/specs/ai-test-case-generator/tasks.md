# 实现计划: AI辅助测试用例生成工具

## 概述

基于Flask框架实现AI辅助测试用例生成工具的后端服务，支持文件上传、AI对话交互、测试用例生成和文件下载等核心功能。采用模块化架构，支持Redis会话管理和流式响应。

## 任务

- [x] 1. 项目结构和基础配置
  - 创建Flask项目目录结构
  - 配置依赖包和虚拟环境
  - 设置配置文件和环境变量
  - _需求: 7.1, 8.1_

- [ ]* 1.1 编写项目配置属性测试
  - **属性 12: 会话唯一性和生命周期**
  - **验证: 需求 7.1, 7.2**

- [ ] 2. 核心服务层实现
  - [x] 2.1 实现会话服务 (SessionService)
    - 创建Redis连接和会话管理逻辑
    - 实现会话创建、获取、更新、删除功能
    - _需求: 7.1, 7.2, 7.3, 7.4_

  - [ ]* 2.2 编写会话服务属性测试
    - **属性 5: 会话有效性验证**
    - **属性 13: 并发会话数据一致性**
    - **验证: 需求 2.4, 7.3, 7.4**

  - [x] 2.3 实现文件服务 (FileService)
    - 创建文件上传、保存、解析功能
    - 实现XML文件解析和生成逻辑
    - _需求: 1.1, 1.2, 1.3, 4.2_

  - [ ]* 2.4 编写文件服务属性测试
    - **属性 1: 文件上传会话创建**
    - **属性 2: 文件格式验证**
    - **属性 8: XML格式转换正确性**
    - **验证: 需求 1.1, 1.2, 1.3, 1.4, 4.2**

- [ ] 3. AI服务集成
  - [x] 3.1 实现AI服务 (AIService)
    - 创建Dify Agent集成逻辑
    - 实现Mock模式和真实服务切换
    - _需求: 2.1, 2.2, 3.1, 10.1_

  - [ ]* 3.2 编写AI服务属性测试
    - **属性 15: 服务降级处理**
    - **属性 17: Mock模式一致性**
    - **验证: 需求 8.4, 10.1, 10.2, 10.3**

  - [x] 3.3 实现对话服务 (ChatService)
    - 创建对话交互和上下文管理
    - 实现关键词识别和状态转换
    - _需求: 2.1, 2.2, 2.3_

  - [ ]* 3.4 编写对话服务属性测试
    - **属性 3: 对话上下文一致性**
    - **属性 4: 关键词触发状态转换**
    - **验证: 需求 2.1, 2.2, 2.3**

- [ ] 4. 检查点 - 核心服务测试
  - 确保所有核心服务测试通过，如有问题请询问用户

- [ ] 5. 生成服务实现
  - [x] 5.1 实现生成服务 (GenerationService)
    - 创建测试用例生成协调逻辑
    - 实现流式响应和进度反馈
    - _需求: 3.1, 3.2, 3.3, 3.4_

  - [ ]* 5.2 编写生成服务属性测试
    - **属性 6: 测试用例生成完整性**
    - **属性 7: 流式响应连续性**
    - **验证: 需求 3.1, 3.2, 3.4, 9.2**

  - [x] 5.3 实现配置服务 (ConfigService)
    - 创建API版本、预设步骤、预设组件数据管理
    - _需求: 6.1, 6.2, 6.3_

  - [ ]* 5.4 编写配置服务单元测试
    - 测试API版本列表获取
    - 测试预设步骤和组件数据返回
    - _需求: 6.1, 6.2, 6.3_

- [ ] 6. API路由层实现
  - [x] 6.1 实现生成相关路由 (routes/generation.py)
    - 创建文件上传、生成、确认、下载接口
    - 实现请求验证和响应格式化
    - _需求: 1.1, 3.1, 4.1, 5.1_

  - [ ]* 6.2 编写生成路由属性测试
    - **属性 9: 数据验证一致性**
    - **属性 10: 文件下载权限控制**
    - **属性 11: HTTP响应头正确性**
    - **验证: 需求 4.4, 5.1, 5.2, 5.3, 5.4, 5.5**

  - [x] 6.3 实现对话路由 (routes/chat.py)
    - 创建对话消息发送接口
    - _需求: 2.1_

  - [x] 6.4 实现配置路由 (routes/config.py)
    - 创建配置数据获取接口
    - _需求: 6.1, 6.2, 6.3_

- [ ] 7. 错误处理和验证
  - [x] 7.1 实现统一错误处理中间件
    - 创建错误分类和响应格式化
    - 实现日志记录功能
    - _需求: 8.1, 8.2, 8.3_

  - [ ]* 7.2 编写错误处理属性测试
    - **属性 14: 错误处理和日志记录**
    - **验证: 需求 8.1, 8.2, 8.3**

  - [x] 7.3 实现输入验证和安全防护
    - 创建文件格式验证
    - 实现输入数据安全检查
    - _需求: 1.4, 9.5_

  - [ ]* 7.4 编写安全验证属性测试
    - **属性 16: 输入安全验证**
    - **验证: 需求 9.5**

- [ ] 8. 应用入口和集成
  - [x] 8.1 创建Flask应用入口 (app.py)
    - 配置Flask应用和中间件
    - 注册所有蓝图和路由
    - 初始化Redis连接
    - _需求: 7.1_

  - [x] 8.2 实现应用配置管理
    - 创建开发、测试、生产环境配置
    - 实现Mock模式配置开关
    - _需求: 10.5_

  - [x]* 8.3 编写集成测试
    - 测试完整的API调用流程
    - 测试文件上传到下载的端到端流程
    - _需求: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 9. 最终检查点 - 完整功能测试
  - 确保所有测试通过，验证完整的用例生成流程，如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务为可选测试任务，可跳过以加快MVP开发
- 每个任务都引用了具体的需求编号以确保可追溯性
- 属性测试使用pytest + hypothesis框架，最少100次迭代
- Mock模式默认启用，便于开发和测试
- 所有文件操作使用临时目录，支持自动清理