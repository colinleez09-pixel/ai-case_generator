<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScriptä¿®å¤æµ‹è¯•</title>
</head>
<body>
    <div id="chatMessages"></div>
    
    <script>
        // æ¨¡æ‹Ÿå¿…è¦çš„å…¨å±€å˜é‡å’Œå‡½æ•°
        const API_BASE_URL = '/api';
        let currentSessionId = null;
        let isGenerating = false;
        
        const elements = {
            chatMessages: document.getElementById('chatMessages')
        };
        
        // ä»static/script.jså¤åˆ¶ç›¸å…³å‡½æ•°è¿›è¡Œæµ‹è¯•
        function showLoadingIndicator(message = "å¤„ç†ä¸­...", containerId = "chatMessages") {
          const loadingId = `loading_${Date.now()}`;
          const container = document.getElementById(containerId);
          
          if (!container) {
            console.error(`å®¹å™¨ä¸å­˜åœ¨: ${containerId}`);
            return null;
          }
          
          const loadingHtml = `
            <div class="loading-indicator" id="${loadingId}">
              <div class="loading-spinner">
                <div class="spinner"></div>
              </div>
              <div class="loading-message">${message}</div>
              <div class="loading-dots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
              </div>
            </div>
          `;
          
          const loadingDiv = document.createElement("div");
          loadingDiv.className = "message ai-message";
          loadingDiv.innerHTML = `
            <div class="message-avatar">Agent</div>
            <div class="message-content">${loadingHtml}</div>
          `;
          
          container.appendChild(loadingDiv);
          container.scrollTop = container.scrollHeight;
          
          return loadingId;
        }
        
        function updateLoadingMessage(loadingId, message) {
          if (loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
              const messageElement = loadingElement.querySelector('.loading-message');
              if (messageElement) {
                messageElement.textContent = message;
              }
            }
          }
        }
        
        function hideLoadingIndicator(loadingId) {
          if (loadingId) {
            const loadingElement = document.getElementById(loadingId);
            if (loadingElement) {
              const messageElement = loadingElement.closest('.message');
              if (messageElement) {
                messageElement.remove();
              }
            }
          }
        }
        
        // æµ‹è¯•å‡½æ•°
        function testUpdateLoadingMessage() {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•updateLoadingMessageå‡½æ•°...');
            
            // 1. åˆ›å»ºåŠ è½½æŒ‡ç¤ºå™¨
            const loadingId = showLoadingIndicator("æ­£åœ¨ä¸Šä¼ æ–‡ä»¶å¹¶åˆ†æ...");
            console.log('âœ… åˆ›å»ºåŠ è½½æŒ‡ç¤ºå™¨:', loadingId);
            
            // 2. æµ‹è¯•æ›´æ–°æ¶ˆæ¯
            setTimeout(() => {
                updateLoadingMessage(loadingId, "æ­£åœ¨è¿æ¥AIæœåŠ¡...");
                console.log('âœ… æ›´æ–°åŠ è½½æ¶ˆæ¯æˆåŠŸ');
                
                // 3. å†æ¬¡æ›´æ–°æ¶ˆæ¯
                setTimeout(() => {
                    updateLoadingMessage(loadingId, "æ­£åœ¨å¤„ç†å“åº”...");
                    console.log('âœ… å†æ¬¡æ›´æ–°åŠ è½½æ¶ˆæ¯æˆåŠŸ');
                    
                    // 4. éšè—åŠ è½½æŒ‡ç¤ºå™¨
                    setTimeout(() => {
                        hideLoadingIndicator(loadingId);
                        console.log('âœ… éšè—åŠ è½½æŒ‡ç¤ºå™¨æˆåŠŸ');
                        console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼updateLoadingMessageå‡½æ•°å·¥ä½œæ­£å¸¸');
                    }, 1000);
                }, 1000);
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', testUpdateLoadingMessage);
    </script>
</body>
</html>