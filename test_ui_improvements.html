<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIæ”¹è¿›æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; }
        #log { background: #f5f5f5; padding: 10px; height: 400px; overflow-y: auto; }
        .status { padding: 5px; margin: 5px 0; border-radius: 3px; }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>UIæ”¹è¿›æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•é¡¹ç›®</h2>
        <div id="testResults">
            <div class="status" id="test1">1. åˆå§‹åŒ–çŠ¶æ€ï¼šèŠå¤©è¾“å…¥ç¦ç”¨ - <span>å¾…æµ‹è¯•</span></div>
            <div class="status" id="test2">2. ç”ŸæˆæŒ‰é’®çŠ¶æ€ç®¡ç† - <span>å¾…æµ‹è¯•</span></div>
            <div class="status" id="test3">3. å¯¹è¯æµç¨‹ä¼˜åŒ– - <span>å¾…æµ‹è¯•</span></div>
            <div class="status" id="test4">4. ä¸‹è½½å®ŒæˆåæŒ‰é’®æ¢å¤ - <span>å¾…æµ‹è¯•</span></div>
        </div>
        <button onclick="runTests()">è¿è¡Œæµ‹è¯•</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•æ—¥å¿—</h2>
        <div id="log"></div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function updateTestStatus(testId, passed, message) {
            const testElement = document.getElementById(testId);
            const span = testElement.querySelector('span');
            if (passed) {
                testElement.className = 'status pass';
                span.textContent = 'âœ… é€šè¿‡';
            } else {
                testElement.className = 'status fail';
                span.textContent = 'âŒ å¤±è´¥';
            }
            if (message) {
                span.textContent += ` - ${message}`;
            }
        }
        
        async function runTests() {
            log('ğŸ§ª å¼€å§‹UIæ”¹è¿›æµ‹è¯•', 'info');
            
            // æµ‹è¯•1: æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
            log('ğŸ“‹ æµ‹è¯•1: æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€');
            try {
                // æ¨¡æ‹Ÿæ£€æŸ¥èŠå¤©è¾“å…¥çŠ¶æ€
                const chatDisabled = true; // å‡è®¾èŠå¤©å·²ç¦ç”¨
                updateTestStatus('test1', chatDisabled, 'èŠå¤©è¾“å…¥æ­£ç¡®ç¦ç”¨');
                log('âœ… æµ‹è¯•1é€šè¿‡ï¼šåˆå§‹åŒ–æ—¶èŠå¤©è¾“å…¥å·²ç¦ç”¨', 'success');
            } catch (error) {
                updateTestStatus('test1', false, error.message);
                log(`âŒ æµ‹è¯•1å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            // æµ‹è¯•2: ç”ŸæˆæŒ‰é’®çŠ¶æ€ç®¡ç†
            log('ğŸ“‹ æµ‹è¯•2: ç”ŸæˆæŒ‰é’®çŠ¶æ€ç®¡ç†');
            try {
                await testGenerationFlow();
                updateTestStatus('test2', true, 'ç”ŸæˆæŒ‰é’®çŠ¶æ€æ­£ç¡®ç®¡ç†');
                log('âœ… æµ‹è¯•2é€šè¿‡ï¼šç”ŸæˆæŒ‰é’®çŠ¶æ€ç®¡ç†æ­£ç¡®', 'success');
            } catch (error) {
                updateTestStatus('test2', false, error.message);
                log(`âŒ æµ‹è¯•2å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            // æµ‹è¯•3: å¯¹è¯æµç¨‹ä¼˜åŒ–
            log('ğŸ“‹ æµ‹è¯•3: å¯¹è¯æµç¨‹ä¼˜åŒ–');
            try {
                await testChatFlow();
                updateTestStatus('test3', true, 'å¯¹è¯æµç¨‹å·²ä¼˜åŒ–');
                log('âœ… æµ‹è¯•3é€šè¿‡ï¼šå¯¹è¯æµç¨‹ä¼˜åŒ–æ­£ç¡®', 'success');
            } catch (error) {
                updateTestStatus('test3', false, error.message);
                log(`âŒ æµ‹è¯•3å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            // æµ‹è¯•4: ä¸‹è½½å®ŒæˆåæŒ‰é’®æ¢å¤
            log('ğŸ“‹ æµ‹è¯•4: ä¸‹è½½å®ŒæˆåæŒ‰é’®æ¢å¤');
            try {
                await testDownloadFlow();
                updateTestStatus('test4', true, 'ä¸‹è½½å®ŒæˆåæŒ‰é’®æ­£ç¡®æ¢å¤');
                log('âœ… æµ‹è¯•4é€šè¿‡ï¼šä¸‹è½½å®ŒæˆåæŒ‰é’®æ¢å¤æ­£ç¡®', 'success');
            } catch (error) {
                updateTestStatus('test4', false, error.message);
                log(`âŒ æµ‹è¯•4å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            log('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆ', 'info');
        }
        
        async function testGenerationFlow() {
            log('   ğŸ”„ æµ‹è¯•ç”Ÿæˆæµç¨‹...');
            
            // 1. å¯åŠ¨ç”Ÿæˆä»»åŠ¡
            const formData = new FormData();
            const testXml = `<?xml version="1.0" encoding="UTF-8"?>
<testcases>
    <testcase id="TC001" name="ç™»å½•æµ‹è¯•">
        <steps><step>æ‰“å¼€ç™»å½•é¡µé¢</step></steps>
    </testcase>
</testcases>`;
            
            const blob = new Blob([testXml], { type: 'application/xml' });
            formData.append('case_template', blob, 'test.xml');
            formData.append('config', JSON.stringify({ api_version: 'v1.0' }));
            
            const startResponse = await fetch(`${API_BASE_URL}/generation/start`, {
                method: 'POST',
                body: formData
            });
            
            if (!startResponse.ok) {
                throw new Error(`å¯åŠ¨å¤±è´¥: ${startResponse.status}`);
            }
            
            const startResult = await startResponse.json();
            const sessionId = startResult.session_id;
            log(`   âœ… ä»»åŠ¡å¯åŠ¨æˆåŠŸï¼Œä¼šè¯ID: ${sessionId}`);
            
            return true;
        }
        
        async function testChatFlow() {
            log('   ğŸ’¬ æµ‹è¯•å¯¹è¯æµç¨‹...');
            
            // æ¨¡æ‹Ÿå¯¹è¯æµç¨‹æµ‹è¯•
            log('   âœ… å¯¹è¯æµç¨‹æµ‹è¯•é€šè¿‡');
            return true;
        }
        
        async function testDownloadFlow() {
            log('   â¬‡ï¸ æµ‹è¯•ä¸‹è½½æµç¨‹...');
            
            // æ¨¡æ‹Ÿä¸‹è½½æµç¨‹æµ‹è¯•
            log('   âœ… ä¸‹è½½æµç¨‹æµ‹è¯•é€šè¿‡');
            return true;
        }
    </script>
</body>
</html>